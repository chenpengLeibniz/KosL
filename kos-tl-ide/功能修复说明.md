# KOS-TL IDE 功能修复说明

## ✅ 已修复的问题

### 1. 打开工作区功能
- **问题**: 打开工作区后，IDE 没有任何反应
- **修复**: 
  - 打开工作区后，自动加载文件树
  - 如果工作区中有 `.kos` 文件，自动打开第一个文件
  - 文件树正确显示工作区中的所有文件

### 2. 打开文件功能
- **问题**: 打开文件后，编辑器不显示内容
- **修复**:
  - 修复了编辑器初始化问题，确保文件内容正确显示
  - 添加了文件路径到编辑器，支持语法高亮和错误标记
  - 自动检测工作区（如果文件在工作区中）
  - 添加了详细的错误处理和日志

### 3. 编辑器显示
- **问题**: 编辑器在文件打开时不能正确显示内容
- **修复**:
  - 使用 Monaco Editor 的模型系统，正确管理文件模型
  - 支持文件路径变化时的模型切换
  - 保持光标位置和滚动位置
  - 正确更新错误标记

### 4. 编译功能
- **问题**: 编译功能可能无法找到编译器
- **修复**:
  - 自动检测 Windows 上的 `.exe` 扩展名
  - 添加了详细的错误提示，包括编译器路径
  - 添加了调试日志，方便排查问题
  - 改进了错误消息显示

## 📋 使用说明

### 前置条件

**重要**: 在使用 IDE 之前，需要先构建 KOS-TL 编译器：

```powershell
cd compiler
mkdir build
cd build
cmake ..
cmake --build .
```

编译器将生成在 `compiler/build/bin/kos-tl-compiler.exe` (Windows) 或 `compiler/build/bin/kos-tl-compiler` (Linux/macOS)。

### 启动 IDE

#### 开发模式
```powershell
cd kos-tl-ide
npm run dev
```

#### 生产模式
```powershell
cd kos-tl-ide
npm run build
.\node_modules\.bin\electron.cmd dist/main/main.js
```

### 使用功能

#### 1. 打开文件
- **菜单**: 文件 → 打开文件 (Ctrl+O)
- **功能**: 打开单个 `.kos` 文件进行编辑
- **自动功能**: 
  - 自动检测工作区（如果文件在工作区中）
  - 自动进行类型检查
  - 显示语法高亮

#### 2. 打开工作区
- **菜单**: 文件 → 打开工作区 (Ctrl+K Ctrl+O)
- **功能**: 打开一个目录作为工作区
- **自动功能**:
  - 显示文件树
  - 如果工作区中有 `.kos` 文件，自动打开第一个
  - 支持在文件树中点击文件打开

#### 3. 编辑文件
- **功能**: 
  - 语法高亮
  - 代码补全
  - 实时类型检查（防抖 500ms）
  - 错误标记显示

#### 4. 编译文件
- **菜单**: 运行 → 编译 (F5)
- **功能**: 
  - 自动保存文件
  - 调用编译器编译 `.kos` 文件
  - 显示编译输出和错误
- **要求**: 编译器必须已构建并在正确路径

#### 5. 类型检查
- **菜单**: 运行 → 类型检查 (F6)
- **功能**: 
  - 只进行类型检查，不生成代码
  - 显示类型错误
- **自动**: 文件打开和编辑时自动进行类型检查

## 🔧 故障排查

### 问题 1: 编译器未找到

**错误消息**: `编译器未找到: ...`

**解决方案**:
1. 确保编译器已构建（见前置条件）
2. 检查编译器路径是否正确：
   - 开发环境: `compiler/build/bin/kos-tl-compiler.exe` (Windows)
   - 打包环境: `resources/compiler/kos-tl-compiler.exe` (Windows)
3. 如果路径不正确，可以在设置中配置编译器路径（待实现）

### 问题 2: 文件无法打开

**可能原因**:
1. `electronAPI` 未正确加载
2. 文件路径不正确
3. 文件权限问题

**解决方案**:
1. 打开开发者工具（视图 → 切换开发者工具）查看控制台错误
2. 检查文件路径是否正确
3. 确保文件有读取权限

### 问题 3: 编辑器不显示内容

**可能原因**:
1. Monaco Editor 未正确初始化
2. 文件内容为空
3. 文件路径未正确传递

**解决方案**:
1. 检查控制台是否有错误
2. 尝试重新打开文件
3. 检查文件内容是否为空

### 问题 4: 编译失败

**可能原因**:
1. 编译器未构建
2. 编译器路径不正确
3. 源代码有错误

**解决方案**:
1. 确保编译器已构建
2. 检查编译器路径
3. 查看编译错误消息，修复源代码错误

## 📝 调试信息

IDE 现在包含详细的调试日志：

- **控制台日志**: 打开开发者工具查看详细日志
- **文件操作**: 所有文件操作都会记录日志
- **编译过程**: 编译过程会显示详细步骤
- **错误信息**: 所有错误都会显示详细信息

## 🎯 下一步改进

1. **设置面板**: 允许用户配置编译器路径
2. **运行功能**: 实现运行编译后的程序
3. **调试功能**: 实现调试支持
4. **代码格式化**: 实现代码格式化功能
5. **更多快捷键**: 添加更多快捷键支持

---

**修复完成！现在 IDE 的所有核心功能都应该正常工作了！** 🎉
