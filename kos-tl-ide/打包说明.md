# KOS-TL IDE 打包说明

## 快速打包步骤

### Windows

1. **打开 PowerShell 或 CMD，进入项目目录**:
   ```powershell
   cd kos-tl-ide
   ```

2. **安装依赖**:
   ```powershell
   npm install
   ```

3. **构建项目**:
   ```powershell
   npm run build
   ```
   或者使用构建脚本:
   ```powershell
   .\build.bat
   ```

4. **打包为可执行文件**:
   ```powershell
   npm run package:win
   ```

打包完成后，可执行文件在 `release/` 目录中。

### Linux/macOS

1. **进入项目目录**:
   ```bash
   cd kos-tl-ide
   ```

2. **安装依赖**:
   ```bash
   npm install
   ```

3. **构建项目**:
   ```bash
   npm run build
   ```
   或者使用构建脚本:
   ```bash
   chmod +x build.sh
   ./build.sh
   ```

4. **打包**:
   ```bash
   npm run package        # 当前平台
   npm run package:win    # Windows
   npm run package:mac    # macOS
   npm run package:linux  # Linux
   ```

## 详细步骤

### 步骤 1: 确保编译器已构建

在打包 IDE 之前，需要先构建 KOS-TL 编译器：

```bash
cd ../compiler
mkdir build
cd build
cmake ..
cmake --build . --config Release
```

### 步骤 2: 安装 IDE 依赖

```bash
cd kos-tl-ide
npm install
```

### 步骤 3: 构建 IDE

```bash
npm run build
```

这会：
- 编译主进程 TypeScript 代码到 `dist/main/`
- 构建渲染进程到 `dist/renderer/`

### 步骤 4: 打包

```bash
# Windows
npm run package:win

# macOS
npm run package:mac

# Linux
npm run package:linux
```

## 输出文件

打包完成后，可执行文件在 `release/` 目录：

- **Windows**: `KOS-TL IDE Setup x.x.x.exe` (NSIS 安装程序)
- **macOS**: `KOS-TL IDE-x.x.x.dmg`
- **Linux**: `KOS-TL IDE-x.x.x.AppImage`

## 常见问题

### 1. 构建失败：找不到模块

**解决**: 运行 `npm install` 安装所有依赖

### 2. TypeScript 编译错误

**解决**: 
- 检查代码中的类型错误
- 确保所有依赖已安装

### 3. Webpack 构建失败

**解决**:
- 检查 `renderer/webpack.config.js`
- 确保所有资源文件存在

### 4. Electron Builder 打包失败

**解决**:
- 确保已安装所有依赖
- 检查 `package.json` 中的 `build` 配置
- 如果指定了图标，确保图标文件存在

### 5. 找不到编译器

**解决**:
- 确保编译器已构建
- 检查编译器路径配置
- 在打包的应用中，编译器应该在 `resources/compiler/` 目录

## 验证打包结果

### Windows
1. 运行安装程序: `release/KOS-TL IDE Setup x.x.x.exe`
2. 安装后启动应用
3. 测试基本功能（打开文件、编辑、编译）

### macOS
1. 挂载 DMG: `open release/KOS-TL\ IDE-x.x.x.dmg`
2. 拖拽应用到 Applications
3. 运行应用测试

### Linux
1. 添加执行权限: `chmod +x release/KOS-TL\ IDE-x.x.x.AppImage`
2. 运行: `./release/KOS-TL\ IDE-x.x.x.AppImage`

## 注意事项

1. **编译器路径**: 打包的应用中，编译器路径会自动调整为 `resources/compiler/kos-tl-compiler`
2. **图标文件**: 如果指定了图标但文件不存在，打包会失败
3. **文件大小**: 首次打包可能需要下载 Electron 二进制文件，请耐心等待
4. **网络**: 打包过程可能需要网络连接（下载 Electron）

## 下一步

打包完成后，可以：
- 测试应用功能
- 分发应用
- 添加自动更新功能
- 实现代码签名（macOS/Windows）





