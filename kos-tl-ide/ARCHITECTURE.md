# KOS-TL IDE 架构设计

## 概述

KOS-TL IDE 是一个基于 Electron 和 Monaco Editor 构建的专门针对 KOS-TL 语言的集成开发环境。与 VS Code 插件不同，这是一个独立的桌面应用程序，提供完全定制的用户体验。

## 架构层次

```
┌─────────────────────────────────────────────────┐
│            Electron 主进程 (Node.js)              │
│  - 窗口管理                                       │
│  - 文件系统访问                                   │
│  - 编译器进程管理                                 │
│  - IPC 通信                                       │
└─────────────────┬───────────────────────────────┘
                  │ IPC
┌─────────────────▼───────────────────────────────┐
│        渲染进程 (Chromium + React)                │
│  ┌───────────────────────────────────────────┐  │
│  │         Monaco Editor (代码编辑)            │  │
│  └───────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────┐  │
│  │         React UI (界面组件)                │  │
│  │  - Sidebar (文件树、类型视图)              │  │
│  │  - Editor (Monaco集成)                     │  │
│  │  - Panels (类型、错误)                     │  │
│  │  - StatusBar (状态栏)                      │  │
│  └───────────────────────────────────────────┘  │
└─────────────────┬───────────────────────────────┘
                  │
┌─────────────────▼───────────────────────────────┐
│         语言服务 (可选)                          │
│  - 词法分析                                      │
│  - 语法分析                                      │
│  - 类型检查                                      │
│  - 代码补全                                      │
└─────────────────────────────────────────────────┘
                  │
┌─────────────────▼───────────────────────────────┐
│        KOS-TL 编译器 (C)                         │
│  - 编译为C代码                                   │
│  - 类型检查                                      │
│  - 错误报告                                      │
└─────────────────────────────────────────────────┘
```

## 核心组件

### 1. Electron 主进程

**文件**: `main/main.ts`

职责：
- 创建和管理应用窗口
- 处理文件系统操作
- 管理编译器进程
- 提供 IPC 接口

**IPC 接口**:
- `compile`: 编译 KOS-TL 文件
- `typeCheck`: 类型检查
- `openFile`: 打开文件对话框
- `saveFile`: 保存文件对话框
- `readFile/writeFile`: 文件读写

### 2. 渲染进程 (React)

**文件**: `renderer/src/App.tsx`

职责：
- 管理应用状态
- 协调各个组件
- 处理用户交互

**主要组件**:
- `Editor`: Monaco Editor 集成
- `Sidebar`: 文件树和导航
- `TypePanel`: 类型信息显示
- `ErrorPanel`: 错误列表
- `StatusBar`: 状态栏

### 3. Monaco Editor 集成

**文件**: `renderer/src/monaco/kos-tl-language.ts`

功能：
- 注册 KOS-TL 语言
- 语法高亮
- 代码补全
- 错误标记

### 4. 编译器集成

通过 IPC 调用主进程中的编译器：
- 实时类型检查
- 编译到 C 代码
- 错误解析和显示

## 与 VS Code 插件的区别

| 特性 | VS Code 插件 | KOS-TL IDE |
|------|-------------|-----------|
| **安装** | 通过插件市场 | 独立安装包 |
| **启动** | 在VS Code中 | 独立应用 |
| **UI定制** | 受限（VS Code主题） | 完全定制 |
| **性能** | 受VS Code限制 | 优化性能 |
| **功能** | 插件API限制 | 原生功能 |
| **用户体验** | 通用编辑器体验 | 专门优化 |

## 技术选型理由

### Electron
- ✅ 跨平台（Windows, macOS, Linux）
- ✅ 成熟的桌面应用框架
- ✅ 可以使用 Node.js 和 Web 技术

### Monaco Editor
- ✅ VS Code 的编辑器核心
- ✅ 强大的代码编辑功能
- ✅ 可扩展的语言支持

### React
- ✅ 组件化UI开发
- ✅ 丰富的生态系统
- ✅ 良好的性能

## 数据流

```
用户输入
  ↓
Monaco Editor
  ↓
React State (App.tsx)
  ↓
IPC (electronAPI)
  ↓
Electron 主进程
  ↓
编译器进程
  ↓
结果返回
  ↓
React State 更新
  ↓
UI 更新
```

## 扩展点

1. **语言服务**: 可以集成独立的语言服务器
2. **插件系统**: 未来可以支持插件
3. **主题系统**: 自定义主题
4. **快捷键**: 完全自定义快捷键
5. **工作区**: 支持多文件项目

## 性能优化

1. **增量编译**: 只编译修改的文件
2. **延迟加载**: 按需加载语言服务
3. **虚拟滚动**: 大文件性能优化
4. **Web Worker**: 后台类型检查

## 安全性

1. **Context Isolation**: 隔离渲染进程和主进程
2. **Preload Script**: 安全的API暴露
3. **CSP**: 内容安全策略
4. **文件访问**: 受限的文件系统访问





